<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://unpkg.com/js-alert/dist/jsalert.min.js"></script>
    <title>Single Player Pong</title>
    <style>
      * {
        margin: 0;
        padding: 0;
      }
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background-color: #1d1d21;
      }
      canvas {
        background-color: #000;
        border: 2px solid #fff;
      }
      .info {
        text-align: center;
        color: white;
        font-size: 20px;
        margin-top: 10px;
      }
      #back-button {
        padding: 5px 5px;
        font-size: 12px;
        cursor: pointer;
        background-color: #444;
        color: white;
        border: none;
        border-radius: 5px;
        position: fixed;
        bottom: 5px;
        left: 5px;
      }
    </style>
  </head>
  <body>
    <canvas id="pongCanvas" width="600" height="450"></canvas>
    <div class="info">
      <p id="status"></p>
    </div>
    <button id="back-button" onclick="window.history.back()">
      &nbsp;â†«&nbsp;
    </button>

    <script>
      const canvas = document.getElementById("pongCanvas");
      const ctx = canvas.getContext("2d");

      const paddleHeight = 10,
        paddleWidth = 100;
      const ballRadius = 10;

      let player = {
        x: canvas.width / 2 - paddleWidth / 2,
        y: canvas.height - paddleHeight,
        score: 0,
        dx: 0,
      };

      let ball = {
        x: canvas.width / 2,
        y: canvas.height / 2,
        dx: 4,
        dy: 4,
      };

      const winningScore = 10;
      let isGameOver = false;

      const statusElement = document.getElementById("status");

      document.addEventListener("keydown", keyDownHandler);
      document.addEventListener("keyup", keyUpHandler);

      function keyDownHandler(e) {
        if (e.keyCode === 37) player.dx = -8; // Left arrow
        if (e.keyCode === 39) player.dx = 8; // Right arrow
      }

      function keyUpHandler(e) {
        if (e.keyCode === 37 || e.keyCode === 39) player.dx = 0;
      }

      function drawPaddle() {
        ctx.fillStyle = "white";
        ctx.fillRect(player.x, player.y, paddleWidth, paddleHeight);
      }

      function drawBall() {
        ctx.beginPath();
        ctx.arc(ball.x, ball.y, ballRadius, 0, Math.PI * 2);
        ctx.fillStyle = "white";
        ctx.fill();
        ctx.closePath();
      }

      function drawScore() {
        ctx.font = "32px Arial";
        ctx.fillStyle = "white";
        ctx.fillText(player.score, canvas.width / 2 - 20, 50);
      }

      function moveBall() {
        ball.x += ball.dx;
        ball.y += ball.dy;

        // Ball bounces off top and side borders
        if (ball.y - ballRadius < 0) {
          ball.dy = -ball.dy;
        }
        if (ball.x + ballRadius > canvas.width || ball.x - ballRadius < 0) {
          ball.dx = -ball.dx;
        }

        // Check if the ball hits the paddle
        if (
          ball.y + ballRadius >= player.y &&
          ball.x > player.x &&
          ball.x < player.x + paddleWidth
        ) {
          ball.dy = -ball.dy;
          player.score++;
          if (player.score === winningScore) {
            endGame("win");
          }
        }

        // Ball falls below the paddle (lose condition)
        if (ball.y + ballRadius > canvas.height) {
          endGame("lose");
        }
      }

      function movePaddle() {
        player.x += player.dx;

        // Prevent paddle from going out of bounds
        if (player.x < 0) player.x = 0;
        if (player.x + paddleWidth > canvas.width)
          player.x = canvas.width - paddleWidth;
      }

      function checkWin() {
        if (player.score === winningScore) {
          endGame("win");
        }
      }

      function endGame(result) {
        clearInterval(gameInterval);
        isGameOver = true;

        if (result === "win") {
          const USER_CREDITS = localStorage.getItem("USER_CREDITS");
          if (USER_CREDITS) {
            localStorage.setItem("USER_CREDITS", parseInt(USER_CREDITS) + 20);
          } else {
            localStorage.setItem("USER_CREDITS", 20);
          }
          JSAlert.alert("Congratulations! You won!").then(() => {
            location.reload();
          });
        } else {
          JSAlert.alert("Game Over! Try Again").then(() => {
            location.reload();
          });
        }
      }

      function drawGame() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        drawPaddle();
        drawBall();
        drawScore();

        moveBall();
        movePaddle();
      }

      let gameInterval = setInterval(drawGame, 16);
    </script>
  </body>
</html>
